"use strict";(self.webpackChunkrspress_doc_template=self.webpackChunkrspress_doc_template||[]).push([["7151"],{96978:function(e,s,n){n.r(s);var r=n(85893),i=n(50065);function l(e){let s=Object.assign({h1:"h1",a:"a",p:"p",ol:"ol",li:"li",code:"code",h2:"h2",div:"div",br:"br",ul:"ul",pre:"pre",span:"span",h3:"h3",table:"table",thead:"thead",tr:"tr",th:"th",strong:"strong",tbody:"tbody",td:"td"},(0,i.ah)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s.h1,{id:"advanced-development",children:[(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#advanced-development",children:"#"}),"Advanced Development"]}),"\n",(0,r.jsx)(s.p,{children:"In this chapter, we will introduce the advanced development workflow of D-Robotics-LLM."}),"\n",(0,r.jsx)(s.p,{children:"This workflow applies to the following scenarios:"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"Cases where the model has already been fine-tuned and requires re-quantization."}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"Simple single-turn conversations."}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"Calculating the model's Perplexity (PPL) metric on edge devices."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["For the above scenarios, we will use the ",(0,r.jsx)(s.code,{children:"InternLM2-1.8B"})," model as an example to illustrate usage."]}),"\n",(0,r.jsxs)(s.h2,{id:"environment-setup",children:[(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#environment-setup",children:"#"}),"Environment Setup"]}),"\n",(0,r.jsxs)(s.p,{children:["Please ensure you have correctly completed environment setup for both the development host and the development board as described in the ",(0,r.jsx)(s.a,{href:"/latest/en/guide/env_install.html",children:"Environment Deployment"})," section."]}),"\n",(0,r.jsxs)(s.h2,{id:"deployment-package-preparation",children:[(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#deployment-package-preparation",children:"#"}),"Deployment Package Preparation"]}),"\n",(0,r.jsxs)(s.p,{children:["Download the provided ",(0,r.jsx)(s.code,{children:"D-Robotics_LLM_{version}.tar.gz"})," deployment package and extract it."]}),"\n",(0,r.jsxs)(s.h2,{id:"model-preparation",children:[(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#model-preparation",children:"#"}),"Model Preparation"]}),"\n",(0,r.jsxs)(s.div,{className:"rspress-directive warning",children:[(0,r.jsx)(s.div,{className:"rspress-directive-title",children:"Note"}),(0,r.jsx)(s.div,{className:"rspress-directive-content",children:(0,r.jsxs)(s.p,{children:["Currently, only the ",(0,r.jsx)(s.code,{children:"InternLM2-1.8B"})," model is supported.",(0,r.jsx)(s.br,{}),"\n","Before downloading the model, please ensure you understand the model's license terms, dependency requirements, and other necessary information to guarantee proper subsequent usage."]})})]}),"\n",(0,r.jsx)(s.p,{children:"You can obtain the InternLM2 series models from the Hugging Face platform. Below are the download links:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"https://huggingface.co/internlm/internlm2-1_8b",target:"_blank",rel:"noopener noreferrer",children:"InternLM2-1.8B Model"})}),"\n"]}),"\n",(0,r.jsxs)(s.h2,{id:"model_quantization",children:[(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#model_quantization",children:"#"}),"Model Quantization"]}),"\n",(0,r.jsxs)(s.p,{children:["D-Robotics-LLM provides a command-line tool to quantize and compile models for edge-device deployment. Taking the ",(0,r.jsx)(s.code,{children:"InternLM2-1.8B"})," model as an example, the reference command is as follows:"]}),"\n",(0,r.jsx)(s.pre,{className:"code",children:(0,r.jsx)(s.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,r.jsxs)(s.code,{className:"language-bash",meta:"",children:[(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"oellm_build"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" \\"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"--model_name"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"internlm2-1_8b"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" \\"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"--input_model_path"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"./InternLM2-1.8B"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" \\"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"--output_model_path"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"./output_hbm"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" \\"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"--march"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"nash-m"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  \\"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"--chunk_size"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"256"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" \\"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"--cache_len"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"1024"})]}),"\n"]})})}),"\n",(0,r.jsxs)(s.div,{className:"rspress-directive info",children:[(0,r.jsx)(s.div,{className:"rspress-directive-title",children:"Note"}),(0,r.jsx)(s.div,{className:"rspress-directive-content",children:(0,r.jsxs)(s.p,{children:["For detailed usage instructions and important considerations regarding the ",(0,r.jsx)(s.code,{children:"oellm_build"})," tool, please refer to the ",(0,r.jsx)(s.a,{href:"/latest/en/guide/tool_introduction/oellm_build.html",children:"oellm_build Tool"})," section."]})})]}),"\n",(0,r.jsxs)(s.p,{children:["If you obtain our pre-compiled ",(0,r.jsx)(s.code,{children:".hbm"})," model via the link provided in ",(0,r.jsx)(s.code,{children:"resolve_model.txt"}),", you may skip this model quantization step."]}),"\n",(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"InternLM2"})," model provided in the ",(0,r.jsx)(s.code,{children:"resolve_model.txt"})," file was compiled with ",(0,r.jsx)(s.code,{children:"chunk_size"})," set to ",(0,r.jsx)(s.code,{children:"256"})," and ",(0,r.jsx)(s.code,{children:"cache_len"})," set to ",(0,r.jsx)(s.code,{children:"1024"}),"."]}),"\n",(0,r.jsxs)(s.h2,{id:"edge-device-runtime-preparation",children:[(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#edge-device-runtime-preparation",children:"#"}),"Edge Device Runtime Preparation"]}),"\n",(0,r.jsxs)(s.p,{children:["In the directory ",(0,r.jsx)(s.code,{children:"D-Robotics_LLM_{version}/oellm_runtime/example"}),", we have pre-prepared compiled executables in each subdirectory that can be directly run on the edge device. Alternatively, you can execute different build scripts to generate the required files yourself. Reference commands are as follows:"]}),"\n",(0,r.jsx)(s.pre,{className:"code",children:(0,r.jsx)(s.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,r.jsxs)(s.code,{className:"language-bash",meta:"",children:[(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"# Simple conversation"})}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"sh"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"build_oellm_run.sh"})]}),"\n",(0,r.jsx)(s.span,{className:"line line-number"}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"# PPL evaluation"})}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"sh"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"build_oellm_ppl.sh"})]}),"\n"]})})}),"\n",(0,r.jsx)(s.p,{children:"Next, create a working directory on the edge device with the following command:"}),"\n",(0,r.jsx)(s.pre,{className:"code",children:(0,r.jsx)(s.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,r.jsxs)(s.code,{className:"language-bash",meta:"",children:[(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"# Running on S100/S100P"})}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"mkdir"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"-p"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"/home/root/llm"})]}),"\n"]})})}),"\n",(0,r.jsx)(s.p,{children:"Before deploying to the board, ensure you have prepared the following:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"A functional development board for running programs on the edge device."}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["A deployable model file (",(0,r.jsx)(s.code,{children:"*.hbm"}),"), which is the output from ",(0,r.jsx)(s.a,{href:"#model_quantization",children:"Model Quantization"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Executable files (",(0,r.jsx)(s.code,{children:"oellm_run"})," and ",(0,r.jsx)(s.code,{children:"oellm_ppl"}),")."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"Runtime dependency libraries. To reduce deployment overhead, you can directly use the contents within the D-Robotics-LLM package, including:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"D-Robotics_LLM_{version}/oellm_runtime/set_performance_mode.sh"})}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"D-Robotics_LLM_{version}/oellm_runtime/lib"})," folder"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"D-Robotics_LLM_{version}/oellm_runtime/config"})," folder"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"D-Robotics_LLM_{version}/oellm_runtime/example"})," folder"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["After preparation, integrate the model file (",(0,r.jsx)(s.code,{children:"*.hbm"}),"), executable files, and dependency libraries into a unified directory structure as shown below:"]}),"\n",(0,r.jsx)(s.pre,{className:"code",children:(0,r.jsx)(s.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,r.jsxs)(s.code,{className:"language-text",meta:"",children:[(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"root@ubuntu:/home/root/llm"})}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"."})}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"|-- model"})}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"|   |-- resolve_model.txt"})}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"|   |-- InternLM2_1.8B_1024.hbm"})}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"|-- config"})}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"|   |-- InternLM2_1.8B_config"})}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"|-- example"})}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"|   |-- oellm_run"})}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"|   |   |-- oellm_run"})}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"|   |-- oellm_ppl"})}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"|   |   |-- oellm_ppl"})}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"|   |   |-- internlm2_ppl_config.json"})}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"|   |   |-- test-00000-of-00001.bin"})}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"|-- include"})}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"|-- lib"})}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"`--set_performance_mode.sh"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})})]})})}),"\n",(0,r.jsx)(s.p,{children:"Copy the integrated folder from your development host to the edge device using the following command:"}),"\n",(0,r.jsx)(s.pre,{className:"code",children:(0,r.jsx)(s.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,r.jsxs)(s.code,{className:"language-bash",meta:"",children:[(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"scp"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"-r"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"llm/*"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"root@{board_ip}:/home/root/llm"})]}),"\n"]})})}),"\n",(0,r.jsxs)(s.p,{children:["Finally, configure the ",(0,r.jsx)(s.code,{children:"LD_LIBRARY_PATH"})," under the path ",(0,r.jsx)(s.code,{children:"/home/root/llm/D-Robotics_LLM_{version}/oellm_runtime"})," with the following commands:"]}),"\n",(0,r.jsx)(s.pre,{className:"code",children:(0,r.jsx)(s.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,r.jsxs)(s.code,{className:"language-bash",meta:"",children:[(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"# Modify hardware register values to switch the device into performance mode"})}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"sh"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"set_performance_mode.sh"})]}),"\n",(0,r.jsx)(s.span,{className:"line line-number"}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"# Set environment variables"})}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"lib"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"/home/root/llm/lib"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" LD_LIBRARY_PATH"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"${lib}"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"${LD_LIBRARY_PATH}"})]}),"\n"]})})}),"\n",(0,r.jsxs)(s.h2,{id:"edge-device-execution",children:[(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#edge-device-execution",children:"#"}),"Edge Device Execution"]}),"\n",(0,r.jsxs)(s.h3,{id:"simple-conversation",children:[(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#simple-conversation",children:"#"}),"Simple Conversation"]}),"\n",(0,r.jsx)(s.p,{children:"Reference command for running on the edge device:"}),"\n",(0,r.jsx)(s.pre,{className:"code",children:(0,r.jsx)(s.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,r.jsxs)(s.code,{className:"language-bash",meta:"",children:[(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"cd"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"./example/oellm_run"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"./oellm_run"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"--hbm_path"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"../../model/InternLM2_1.8B_1024.hbm"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" \\"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"--tokenizer_dir"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"../../config/InternLM2_1.8B_config/"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" \\"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"--model_type"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"4"})]}),"\n"]})})}),"\n",(0,r.jsx)(s.p,{children:"Runtime parameters are as follows:"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:(0,r.jsx)(s.strong,{children:"Parameter"})}),(0,r.jsx)(s.th,{children:(0,r.jsx)(s.strong,{children:"Description"})}),(0,r.jsx)(s.th,{children:(0,r.jsx)(s.strong,{children:"Optional/Required"})})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"-h, --help"})}),(0,r.jsx)(s.td,{children:"Display help information."}),(0,r.jsx)(s.td,{children:"/"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"--hbm_path"})}),(0,r.jsxs)(s.td,{children:["Specifies the path to the quantized model file (",(0,r.jsx)(s.code,{children:"*.hbm"}),")."]}),(0,r.jsx)(s.td,{children:"Required"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"--tokenizer_dir"})}),(0,r.jsx)(s.td,{children:"Specifies the tokenizer configuration directory."}),(0,r.jsx)(s.td,{children:"Required"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"--model_type"})}),(0,r.jsxs)(s.td,{children:["Specifies the model type; currently, InternLM uses type ",(0,r.jsx)(s.code,{children:"4"}),"."]}),(0,r.jsx)(s.td,{children:"Required"})]})]})]}),"\n",(0,r.jsxs)(s.h3,{id:"ppl-evaluation",children:[(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#ppl-evaluation",children:"#"}),"PPL Evaluation"]}),"\n",(0,r.jsx)(s.p,{children:"Reference command for calculating the model's PPL on the edge device:"}),"\n",(0,r.jsx)(s.pre,{className:"code",children:(0,r.jsx)(s.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,r.jsxs)(s.code,{className:"language-bash",meta:"",children:[(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"cd"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"./example/oellm_ppl"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"./oellm_ppl"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"-c"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"./internlm2_ppl_config.json"})]}),"\n"]})})}),"\n",(0,r.jsx)(s.p,{children:"Program input parameters are as follows:"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:(0,r.jsx)(s.strong,{children:"Parameter"})}),(0,r.jsx)(s.th,{children:(0,r.jsx)(s.strong,{children:"Description"})}),(0,r.jsx)(s.th,{children:(0,r.jsx)(s.strong,{children:"Optional/Required"})})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"-h, --help"})}),(0,r.jsx)(s.td,{children:"Display help information."}),(0,r.jsx)(s.td,{children:"/"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"-c, --config"})}),(0,r.jsx)(s.td,{children:"Specifies the path to the JSON configuration file."}),(0,r.jsx)(s.td,{children:"Required"})]})]})]}),"\n",(0,r.jsx)(s.p,{children:"Example JSON configuration file:"}),"\n",(0,r.jsx)(s.pre,{className:"code",children:(0,r.jsx)(s.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,r.jsxs)(s.code,{className:"language-json",meta:'title="internlm2_ppl_config.json"',children:[(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"{"})}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:'"hbm_path"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"../../model/InternLM2_1.8B_1024.hbm"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:'"tokenizer_dir"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"../../config/InternLM2_1.8B_config/"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:'"model_type"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"4"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:'"ppl_testcase"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"test-00000-of-00001.bin"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:'"load_ckpt"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"false"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:'"text_data_num"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:'"max_length"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"256"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:'"stride"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"100"})]}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n"]})})}),"\n",(0,r.jsx)(s.p,{children:"JSON configuration parameters are explained below:"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:(0,r.jsx)(s.strong,{children:"Parameter"})}),(0,r.jsx)(s.th,{children:(0,r.jsx)(s.strong,{children:"Description"})}),(0,r.jsx)(s.th,{children:(0,r.jsx)(s.strong,{children:"Optional/Required"})})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"hbm_path"})}),(0,r.jsxs)(s.td,{children:["Specifies the path to the quantized model file (",(0,r.jsx)(s.code,{children:"*.hbm"}),")."]}),(0,r.jsx)(s.td,{children:"Required"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"tokenizer_dir"})}),(0,r.jsx)(s.td,{children:"Specifies the tokenizer configuration directory."}),(0,r.jsx)(s.td,{children:"Required"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"model_type"})}),(0,r.jsxs)(s.td,{children:["Specifies the model type; currently, InternLM2 uses type ",(0,r.jsx)(s.code,{children:"4"}),"."]}),(0,r.jsx)(s.td,{children:"Required"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"ppl_testcase"})}),(0,r.jsxs)(s.td,{children:["Specifies the test file path; currently supports only ",(0,r.jsx)(s.code,{children:"bin"})," format."]}),(0,r.jsx)(s.td,{children:"Required"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"max_length"})}),(0,r.jsx)(s.td,{children:"Specifies the sequence length fed into the model per iteration."}),(0,r.jsx)(s.td,{children:"Required"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"stride"})}),(0,r.jsx)(s.td,{children:"Specifies the testing stride."}),(0,r.jsx)(s.td,{children:"Required"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"bpu_core"})}),(0,r.jsxs)(s.td,{children:["Specifies the BPU core to use. Default is ",(0,r.jsx)(s.code,{children:"-1"})," (any core)."]}),(0,r.jsx)(s.td,{children:"Optional"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"load_ckpt"})}),(0,r.jsxs)(s.td,{children:["Whether to resume testing from the last interruption point. Default is ",(0,r.jsx)(s.code,{children:"false"}),"."]}),(0,r.jsx)(s.td,{children:"Optional"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"text_data_num"})}),(0,r.jsxs)(s.td,{children:["Truncates input text to a specified length before testing. If ",(0,r.jsx)(s.code,{children:"text_data_num <= 0"}),", no truncation occurs. Default is ",(0,r.jsx)(s.code,{children:"0"}),"."]}),(0,r.jsx)(s.td,{children:"Optional"})]})]})]}),"\n",(0,r.jsxs)(s.h2,{id:"execution-results",children:[(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#execution-results",children:"#"}),"Execution Results"]}),"\n",(0,r.jsxs)(s.h3,{id:"simple-conversation-1",children:[(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#simple-conversation-1",children:"#"}),"Simple Conversation"]}),"\n",(0,r.jsx)(s.p,{children:"Reference for simple dialogue testing:"}),"\n",(0,r.jsx)(s.pre,{className:"code",children:(0,r.jsx)(s.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,r.jsxs)(s.code,{className:"language-text",meta:"",children:[(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"[User] <<< Today's weather"})}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"[Assistant] >>> Very clear, sunny, and a gentle breeze on my face.  "})}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"Mom took me for a walk in the park.  "})}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'I saw a mother and her daughter feeding birds, and I asked in surprise, "Where did these birds come from?"  '})}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"The woman picked up a long bamboo pole, lifted a small green caterpillar from the ground, then used a long grass stalk to pick up the insect and placed it into the nest to feed the birds.  "})}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'When I walked over there, my mother kindly said, "Look how cute these little ants are!"  '})}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"My mom and I came to the edge of a large flower bed and saw some children playing joyfully amidst laughter.  "})}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'At that moment, an old man was selling watermelons there! As soon as he sat down, he looked around and suddenly widened his eyes\u2014he saw someone approaching with a very large bag to buy melons. The old man immediately ran over, took out a big watermelon from the bag, handed it to the person, and said, "This is a birthday gift my daughter made for me!"  '})}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"After we returned home, Mom started telling me a story.  "})}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"This story taught me a lesson: No matter where you are, as long as you put in effort, you will reap rewards.  "})}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"Performance prefill: 1855.07 tokens/s    decode: 23.83 tokens/s"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})})]})})}),"\n",(0,r.jsxs)(s.h3,{id:"ppl-evaluation-1",children:[(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#ppl-evaluation-1",children:"#"}),"PPL Evaluation"]}),"\n",(0,r.jsxs)(s.p,{children:["After PPL evaluation completes, a ",(0,r.jsx)(s.code,{children:"{ppl_testcase}.json"})," file will be generated in the same directory. The value corresponding to ",(0,r.jsx)(s.code,{children:"Perplexity"})," in this file is the final PPL test result. See the example below:"]}),"\n",(0,r.jsx)(s.pre,{className:"code",children:(0,r.jsx)(s.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,r.jsxs)(s.code,{className:"language-json",meta:"",children:[(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"{"})}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:'"PPL Parameters"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:'"hbm_path"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"InternLM2_1.8B_1024.hbm"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:'"ppl_testcase"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"test-00000-of-00001.bin"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:'"text_data_num"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:'"max_length"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"256"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:'"stride"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"100"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:'"Average Negative Log-Likelihood"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"2.56918"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:'"Perplexity"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"13.0552"})]}),"\n",(0,r.jsx)(s.span,{className:"line line-number",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n"]})})}),"\n",(0,r.jsxs)(s.div,{className:"rspress-directive info",children:[(0,r.jsx)(s.div,{className:"rspress-directive-title",children:"Note"}),(0,r.jsxs)(s.div,{className:"rspress-directive-content",children:[(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["PPL supports resuming evaluation from checkpoints. During execution, the program generates a ",(0,r.jsx)(s.code,{children:"ppl_ckpt.json"})," file in the working directory. When ",(0,r.jsx)(s.code,{children:"load_ckpt"})," is set to ",(0,r.jsx)(s.code,{children:"true"}),", the program reads this file and continues testing from where it left off."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["After the PPL program finishes execution, a JSON file containing key parameters and the PPL calculation result of this test will be generated in the directory where the ",(0,r.jsx)(s.code,{children:"bin"})," test file resides."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"bin"})," file specified by the ",(0,r.jsx)(s.code,{children:"ppl_testcase"})," parameter can be converted from a ",(0,r.jsx)(s.code,{children:"parquet"})," file. An example reference script ",(0,r.jsx)(s.code,{children:"convert_parquet_to_bin.py"})," is provided below:"]}),"\n"]}),"\n"]}),(0,r.jsx)(s.pre,{className:"code",children:(0,r.jsx)(s.pre,{className:"shiki css-variables has-line-number",style:{backgroundColor:"var(--shiki-color-background)"},tabIndex:"0",children:(0,r.jsxs)(s.code,{className:"language-python",meta:"",children:[(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" pandas "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"as"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" pd"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" datasets "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" Dataset"})]}),"\n",(0,r.jsx)(s.span,{className:"line line-number"}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"df "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" pd"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"read_parquet"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"test-00000-of-00001.parquet"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:")"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"dataset_test "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" Dataset"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"from_pandas"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(df)"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"text_data "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"\\n\\n"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"join"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(dataset_test["}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'text'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:"])"})]}),"\n",(0,r.jsx)(s.span,{className:"line line-number"}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"with"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"open"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"test-00000-of-00001.bin"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:", "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"wb"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:")"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"as"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" f"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"})]}),"\n",(0,r.jsxs)(s.span,{className:"line line-number",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    f"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"write"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(text_data."}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"encode"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:"("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"utf-8"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:"))"})]}),"\n"]})})})]})]})]})}function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:s}=Object.assign({},(0,i.ah)(),e.components);return s?(0,r.jsx)(s,Object.assign({},e,{children:(0,r.jsx)(l,e)})):l(e)}s.default=o,o.__RSPRESS_PAGE_META={},o.__RSPRESS_PAGE_META["latest%2Fen%2Fguide%2Fquickstart%2FS100P%2Finternlm2%2Fadvanced_development_internlm2.mdx"]={toc:[{id:"environment-setup",text:"Environment Setup",depth:2},{id:"deployment-package-preparation",text:"Deployment Package Preparation",depth:2},{id:"model-preparation",text:"Model Preparation",depth:2},{id:"model_quantization",text:"Model Quantization",depth:2},{id:"edge-device-runtime-preparation",text:"Edge Device Runtime Preparation",depth:2},{id:"edge-device-execution",text:"Edge Device Execution",depth:2},{id:"simple-conversation",text:"Simple Conversation",depth:3},{id:"ppl-evaluation",text:"PPL Evaluation",depth:3},{id:"execution-results",text:"Execution Results",depth:2},{id:"simple-conversation-1",text:"Simple Conversation",depth:3},{id:"ppl-evaluation-1",text:"PPL Evaluation",depth:3}],title:"Advanced Development",frontmatter:{}}}}]);